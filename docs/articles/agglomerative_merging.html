<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agglomerative Merging • sbmR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Agglomerative Merging">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sbmR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/agglomerative_merging.html">Agglomerative Merging</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Agglomerative Merging</h1>
            
      
      
      <div class="hidden name"><code>agglomerative_merging.Rmd</code></div>

    </div>

    
    
<p>One technique of finding the optimal number of clusters/ best partitioning is using the efficient agglomerative merging algorithm. This is typically used to find the initial state for MCMC chains but can stand on its own as a clustering method.</p>
<p>Agglomerative merging can be acomplished with the SBM class using the method <code><a href="../reference/collapse_groups.html">collapse_groups()</a></code>.</p>
<p>First we will setup a model using a simulated bipartite network dataset. The true number of groups in this dataset is <strong>6</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(bisbmsim)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sbmR)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; ── Attaching packages ────────────────────────────────────────────────────────────────────────────── tidyverse 1.3.0 ──</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; ✔ ggplot2 3.2.1     ✔ purrr   0.3.3</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; ✔ tibble  2.1.3     ✔ dplyr   0.8.3</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; ✔ tidyr   1.0.0     ✔ stringr 1.4.0</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; ✔ readr   1.3.1     ✔ forcats 0.4.0</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; ── Conflicts ───────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">N_a &lt;-<span class="st"> </span><span class="dv">50</span>  <span class="co"># Number of nodes of the a type</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">N_b &lt;-<span class="st"> </span><span class="dv">50</span>  <span class="co"># Number of nodes of the b type</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">K_a &lt;-<span class="st"> </span><span class="dv">3</span>    <span class="co"># How many blocks of a type nodes are there</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">K_b &lt;-<span class="st"> </span><span class="dv">3</span>    <span class="co"># How many blocks of the b type nodes are there</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">b_a &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/bisbmsim/man/assign_group_membership.html">assign_group_membership</a></span>(<span class="dt">N =</span> N_a, <span class="dt">K =</span> K_a) <span class="co"># Block membership for each a node</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">b_b &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/bisbmsim/man/assign_group_membership.html">assign_group_membership</a></span>(<span class="dt">N =</span> N_b, <span class="dt">K =</span> K_b) <span class="co"># Block membership for each b node</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">edges &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/bisbmsim/man/draw_from_model.html">draw_from_model</a></span>(</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  b_a, b_b,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="dt">Lambda =</span> <span class="kw"><a href="https://rdrr.io/pkg/bisbmsim/man/generate_random_lambda.html">generate_random_lambda</a></span>(<span class="dt">K_a =</span> K_a, <span class="dt">K_b =</span> K_b)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(num_edges <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">  </span><span class="kw">select</span>(a, b) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="st">  </span><span class="kw">transmute</span>(</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">    <span class="dt">from =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'a'</span>,a),</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">    <span class="dt">to =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'b'</span>, b)</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">  )</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">nodes &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">    <span class="dt">id =</span> <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(edges<span class="op">$</span>from),</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">    <span class="dt">type =</span> <span class="st">"a"</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24">  ),</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2-26" data-line-number="26">    <span class="dt">id =</span> <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(edges<span class="op">$</span>to),</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">    <span class="dt">type =</span> <span class="st">"b"</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28">  )</a>
<a class="sourceLine" id="cb2-29" data-line-number="29">)</a>
<a class="sourceLine" id="cb2-30" data-line-number="30"></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="co"># Setup SBM model</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33">my_sbm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_sbm.html">create_sbm</a></span>(edges, nodes)</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">my_sbm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">#&gt;      id parent type level</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">#&gt; 1    a1   none    a     0</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">#&gt; 2   a10   none    a     0</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co">#&gt; 3   a11   none    a     0</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co">#&gt; 4   a12   none    a     0</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="co">#&gt; 5   a13   none    a     0</span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="co">#&gt; 6   a14   none    a     0</span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="co">#&gt; 7   a15   none    a     0</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="co">#&gt; 8   a16   none    a     0</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="co">#&gt; 9   a17   none    a     0</span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="co">#&gt; 10  a18   none    a     0</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"><span class="co">#&gt; 11  a19   none    a     0</span></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"><span class="co">#&gt; 12   a2   none    a     0</span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48"><span class="co">#&gt; 13  a20   none    a     0</span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="co">#&gt; 14  a21   none    a     0</span></a>
<a class="sourceLine" id="cb2-50" data-line-number="50"><span class="co">#&gt; 15  a22   none    a     0</span></a>
<a class="sourceLine" id="cb2-51" data-line-number="51"><span class="co">#&gt; 16  a23   none    a     0</span></a>
<a class="sourceLine" id="cb2-52" data-line-number="52"><span class="co">#&gt; 17  a24   none    a     0</span></a>
<a class="sourceLine" id="cb2-53" data-line-number="53"><span class="co">#&gt; 18  a25   none    a     0</span></a>
<a class="sourceLine" id="cb2-54" data-line-number="54"><span class="co">#&gt; 19  a26   none    a     0</span></a>
<a class="sourceLine" id="cb2-55" data-line-number="55"><span class="co">#&gt; 20  a27   none    a     0</span></a>
<a class="sourceLine" id="cb2-56" data-line-number="56"><span class="co">#&gt; 21  a28   none    a     0</span></a>
<a class="sourceLine" id="cb2-57" data-line-number="57"><span class="co">#&gt; 22  a29   none    a     0</span></a>
<a class="sourceLine" id="cb2-58" data-line-number="58"><span class="co">#&gt; 23   a3   none    a     0</span></a>
<a class="sourceLine" id="cb2-59" data-line-number="59"><span class="co">#&gt; 24  a30   none    a     0</span></a>
<a class="sourceLine" id="cb2-60" data-line-number="60"><span class="co">#&gt; 25  a31   none    a     0</span></a>
<a class="sourceLine" id="cb2-61" data-line-number="61"><span class="co">#&gt; 26  a32   none    a     0</span></a>
<a class="sourceLine" id="cb2-62" data-line-number="62"><span class="co">#&gt; 27  a33   none    a     0</span></a>
<a class="sourceLine" id="cb2-63" data-line-number="63"><span class="co">#&gt; 28  a34   none    a     0</span></a>
<a class="sourceLine" id="cb2-64" data-line-number="64"><span class="co">#&gt; 29  a35   none    a     0</span></a>
<a class="sourceLine" id="cb2-65" data-line-number="65"><span class="co">#&gt; 30  a36   none    a     0</span></a>
<a class="sourceLine" id="cb2-66" data-line-number="66"><span class="co">#&gt; 31  a37   none    a     0</span></a>
<a class="sourceLine" id="cb2-67" data-line-number="67"><span class="co">#&gt; 32  a38   none    a     0</span></a>
<a class="sourceLine" id="cb2-68" data-line-number="68"><span class="co">#&gt; 33  a39   none    a     0</span></a>
<a class="sourceLine" id="cb2-69" data-line-number="69"><span class="co">#&gt; 34   a4   none    a     0</span></a>
<a class="sourceLine" id="cb2-70" data-line-number="70"><span class="co">#&gt; 35  a40   none    a     0</span></a>
<a class="sourceLine" id="cb2-71" data-line-number="71"><span class="co">#&gt; 36  a41   none    a     0</span></a>
<a class="sourceLine" id="cb2-72" data-line-number="72"><span class="co">#&gt; 37  a42   none    a     0</span></a>
<a class="sourceLine" id="cb2-73" data-line-number="73"><span class="co">#&gt; 38  a43   none    a     0</span></a>
<a class="sourceLine" id="cb2-74" data-line-number="74"><span class="co">#&gt; 39  a44   none    a     0</span></a>
<a class="sourceLine" id="cb2-75" data-line-number="75"><span class="co">#&gt; 40  a45   none    a     0</span></a>
<a class="sourceLine" id="cb2-76" data-line-number="76"><span class="co">#&gt; 41  a46   none    a     0</span></a>
<a class="sourceLine" id="cb2-77" data-line-number="77"><span class="co">#&gt; 42  a47   none    a     0</span></a>
<a class="sourceLine" id="cb2-78" data-line-number="78"><span class="co">#&gt; 43  a48   none    a     0</span></a>
<a class="sourceLine" id="cb2-79" data-line-number="79"><span class="co">#&gt; 44  a49   none    a     0</span></a>
<a class="sourceLine" id="cb2-80" data-line-number="80"><span class="co">#&gt; 45   a5   none    a     0</span></a>
<a class="sourceLine" id="cb2-81" data-line-number="81"><span class="co">#&gt; 46  a50   none    a     0</span></a>
<a class="sourceLine" id="cb2-82" data-line-number="82"><span class="co">#&gt; 47   a6   none    a     0</span></a>
<a class="sourceLine" id="cb2-83" data-line-number="83"><span class="co">#&gt; 48   a7   none    a     0</span></a>
<a class="sourceLine" id="cb2-84" data-line-number="84"><span class="co">#&gt; 49   a8   none    a     0</span></a>
<a class="sourceLine" id="cb2-85" data-line-number="85"><span class="co">#&gt; 50   a9   none    a     0</span></a>
<a class="sourceLine" id="cb2-86" data-line-number="86"><span class="co">#&gt; 51   b1   none    b     0</span></a>
<a class="sourceLine" id="cb2-87" data-line-number="87"><span class="co">#&gt; 52  b10   none    b     0</span></a>
<a class="sourceLine" id="cb2-88" data-line-number="88"><span class="co">#&gt; 53  b11   none    b     0</span></a>
<a class="sourceLine" id="cb2-89" data-line-number="89"><span class="co">#&gt; 54  b12   none    b     0</span></a>
<a class="sourceLine" id="cb2-90" data-line-number="90"><span class="co">#&gt; 55  b13   none    b     0</span></a>
<a class="sourceLine" id="cb2-91" data-line-number="91"><span class="co">#&gt; 56  b14   none    b     0</span></a>
<a class="sourceLine" id="cb2-92" data-line-number="92"><span class="co">#&gt; 57  b15   none    b     0</span></a>
<a class="sourceLine" id="cb2-93" data-line-number="93"><span class="co">#&gt; 58  b16   none    b     0</span></a>
<a class="sourceLine" id="cb2-94" data-line-number="94"><span class="co">#&gt; 59  b17   none    b     0</span></a>
<a class="sourceLine" id="cb2-95" data-line-number="95"><span class="co">#&gt; 60  b18   none    b     0</span></a>
<a class="sourceLine" id="cb2-96" data-line-number="96"><span class="co">#&gt; 61  b19   none    b     0</span></a>
<a class="sourceLine" id="cb2-97" data-line-number="97"><span class="co">#&gt; 62   b2   none    b     0</span></a>
<a class="sourceLine" id="cb2-98" data-line-number="98"><span class="co">#&gt; 63  b20   none    b     0</span></a>
<a class="sourceLine" id="cb2-99" data-line-number="99"><span class="co">#&gt; 64  b21   none    b     0</span></a>
<a class="sourceLine" id="cb2-100" data-line-number="100"><span class="co">#&gt; 65  b22   none    b     0</span></a>
<a class="sourceLine" id="cb2-101" data-line-number="101"><span class="co">#&gt; 66  b23   none    b     0</span></a>
<a class="sourceLine" id="cb2-102" data-line-number="102"><span class="co">#&gt; 67  b24   none    b     0</span></a>
<a class="sourceLine" id="cb2-103" data-line-number="103"><span class="co">#&gt; 68  b25   none    b     0</span></a>
<a class="sourceLine" id="cb2-104" data-line-number="104"><span class="co">#&gt; 69  b26   none    b     0</span></a>
<a class="sourceLine" id="cb2-105" data-line-number="105"><span class="co">#&gt; 70  b27   none    b     0</span></a>
<a class="sourceLine" id="cb2-106" data-line-number="106"><span class="co">#&gt; 71  b28   none    b     0</span></a>
<a class="sourceLine" id="cb2-107" data-line-number="107"><span class="co">#&gt; 72  b29   none    b     0</span></a>
<a class="sourceLine" id="cb2-108" data-line-number="108"><span class="co">#&gt; 73   b3   none    b     0</span></a>
<a class="sourceLine" id="cb2-109" data-line-number="109"><span class="co">#&gt; 74  b30   none    b     0</span></a>
<a class="sourceLine" id="cb2-110" data-line-number="110"><span class="co">#&gt; 75  b31   none    b     0</span></a>
<a class="sourceLine" id="cb2-111" data-line-number="111"><span class="co">#&gt; 76  b32   none    b     0</span></a>
<a class="sourceLine" id="cb2-112" data-line-number="112"><span class="co">#&gt; 77  b33   none    b     0</span></a>
<a class="sourceLine" id="cb2-113" data-line-number="113"><span class="co">#&gt; 78  b34   none    b     0</span></a>
<a class="sourceLine" id="cb2-114" data-line-number="114"><span class="co">#&gt; 79  b35   none    b     0</span></a>
<a class="sourceLine" id="cb2-115" data-line-number="115"><span class="co">#&gt; 80  b36   none    b     0</span></a>
<a class="sourceLine" id="cb2-116" data-line-number="116"><span class="co">#&gt; 81  b37   none    b     0</span></a>
<a class="sourceLine" id="cb2-117" data-line-number="117"><span class="co">#&gt; 82  b38   none    b     0</span></a>
<a class="sourceLine" id="cb2-118" data-line-number="118"><span class="co">#&gt; 83  b39   none    b     0</span></a>
<a class="sourceLine" id="cb2-119" data-line-number="119"><span class="co">#&gt; 84   b4   none    b     0</span></a>
<a class="sourceLine" id="cb2-120" data-line-number="120"><span class="co">#&gt; 85  b40   none    b     0</span></a>
<a class="sourceLine" id="cb2-121" data-line-number="121"><span class="co">#&gt; 86  b41   none    b     0</span></a>
<a class="sourceLine" id="cb2-122" data-line-number="122"><span class="co">#&gt; 87  b42   none    b     0</span></a>
<a class="sourceLine" id="cb2-123" data-line-number="123"><span class="co">#&gt; 88  b43   none    b     0</span></a>
<a class="sourceLine" id="cb2-124" data-line-number="124"><span class="co">#&gt; 89  b44   none    b     0</span></a>
<a class="sourceLine" id="cb2-125" data-line-number="125"><span class="co">#&gt; 90  b45   none    b     0</span></a>
<a class="sourceLine" id="cb2-126" data-line-number="126"><span class="co">#&gt; 91  b46   none    b     0</span></a>
<a class="sourceLine" id="cb2-127" data-line-number="127"><span class="co">#&gt; 92  b47   none    b     0</span></a>
<a class="sourceLine" id="cb2-128" data-line-number="128"><span class="co">#&gt; 93  b48   none    b     0</span></a>
<a class="sourceLine" id="cb2-129" data-line-number="129"><span class="co">#&gt; 94  b49   none    b     0</span></a>
<a class="sourceLine" id="cb2-130" data-line-number="130"><span class="co">#&gt; 95   b5   none    b     0</span></a>
<a class="sourceLine" id="cb2-131" data-line-number="131"><span class="co">#&gt; 96  b50   none    b     0</span></a>
<a class="sourceLine" id="cb2-132" data-line-number="132"><span class="co">#&gt; 97   b6   none    b     0</span></a>
<a class="sourceLine" id="cb2-133" data-line-number="133"><span class="co">#&gt; 98   b7   none    b     0</span></a>
<a class="sourceLine" id="cb2-134" data-line-number="134"><span class="co">#&gt; 99   b8   none    b     0</span></a>
<a class="sourceLine" id="cb2-135" data-line-number="135"><span class="co">#&gt; 100  b9   none    b     0</span></a>
<a class="sourceLine" id="cb2-136" data-line-number="136"><span class="co">#&gt; NULL</span></a></code></pre></div>
<div id="basic-merging" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-merging" class="anchor"></a>Basic merging</h2>
<p>Now that we have our model setup there are two parameters that control this merging.</p>
<p>First we have <code>GREEDY</code>. When this is set to <code>TRUE</code>, the at every merge step the model will check every possible merge for each node and select the best one.</p>
<p>Second is <code>N_CHECKS_PER_GROUP</code>. When <code>GREEDY</code> is set to <code>FALSE</code>, this parameter controls how many possible merges the model explores for each node before choosing the best one. Higher means a longer run time. Note that these potential merges are done by a random sample of neighbor groups so even if <code>N_CHECKS_PER_GROUP</code> is set to the total number of nodes in the network we are not guarenteed to explore all options like <code>GREEDY</code> does.</p>
<p>First, we will perform a greedy merging. This is done with the <code><a href="../reference/collapse_groups.html">collapse_groups()</a></code> method.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Run initialization algorithm on base level nodes</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">merge_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/collapse_groups.html">collapse_groups</a></span>(my_sbm, <span class="dt">greedy =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>This method returns a list containing the entropy and state of the model at each merge step. We can use these to look at how the merges progressed.</p>
<p>First we will grab the number of groups at each merge step. To do this we pull out the state element and find how many nodes in it have a level of 1 (aka group level).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">extract_n_groups &lt;-<span class="st"> </span><span class="cf">function</span>(merge_results){</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  merge_results <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="st">'state'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span>(<span class="op">~</span>{</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    .x <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">      </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(level <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">      </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">      </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>()</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  })</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="kw">extract_n_groups</span>(merge_results) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; [1] 37 23 20 17 14 13</span></a></code></pre></div>
<p>Next we can look at how that number of groups corresponds to the entropy of the model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">extract_entropy &lt;-<span class="st"> </span><span class="cf">function</span>(merge_results){</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  merge_results <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(<span class="st">'entropy'</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">extract_entropy</span>(merge_results) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; [1] 1242.383 1228.133 1219.325 1216.063 1180.654 1195.559</span></a></code></pre></div>
<p>We should almost always see the entropy decrease as we remove groups but if there is signal in the model and the algorithm found it, we should see a relativel “lack of decrease” around the true structure value. We know the true number of groups in this data is 6 so we can reference that here…</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">results_to_df &lt;-<span class="st"> </span><span class="cf">function</span>(merge_results){</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="dt">n_groups =</span> <span class="kw">extract_n_groups</span>(merge_results),</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="dt">entropy =</span> <span class="kw">extract_entropy</span>(merge_results)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">plot_merge_results &lt;-<span class="st"> </span><span class="cf">function</span>(merge_results_df, <span class="dt">group_cutoff =</span> <span class="dv">30</span>, <span class="dt">trim_axes =</span> <span class="ot">TRUE</span>){</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb6-12" data-line-number="12">  results_below_cutoff &lt;-<span class="st"> </span>merge_results_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(n_groups <span class="op">&lt;</span><span class="st"> </span>group_cutoff)</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb6-15" data-line-number="15">  max_entropy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(results_below_cutoff<span class="op">$</span>entropy)</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  min_entropy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(results_below_cutoff<span class="op">$</span>entropy)</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb6-18" data-line-number="18">  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(merge_results_df, <span class="kw">aes</span>(<span class="dt">x =</span> n_groups, <span class="dt">y =</span> entropy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> K_a <span class="op">+</span><span class="st"> </span>K_b, <span class="dt">color =</span> <span class="st">'orangered'</span>)</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb6-23" data-line-number="23">  <span class="cf">if</span>(trim_axes){</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">    p &lt;-<span class="st"> </span>p <span class="op">+</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="st">      </span><span class="kw">coord_cartesian</span>(</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">        <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, group_cutoff),</a>
<a class="sourceLine" id="cb6-27" data-line-number="27">        <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(min_entropy, max_entropy)</a>
<a class="sourceLine" id="cb6-28" data-line-number="28">      ) </a>
<a class="sourceLine" id="cb6-29" data-line-number="29">  }</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">  </a>
<a class="sourceLine" id="cb6-31" data-line-number="31">  p <span class="op">+</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="st">    </span><span class="kw">scale_x_reverse</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="st">    </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"number of groups"</span>)</a>
<a class="sourceLine" id="cb6-35" data-line-number="35">}</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">merge_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">results_to_df</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_merge_results</span>()</a></code></pre></div>
<p><img src="agglomerative_merging_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="non-greedy-merge-proposals" class="section level2">
<h2 class="hasAnchor">
<a href="#non-greedy-merge-proposals" class="anchor"></a>Non-Greedy merge proposals</h2>
<p>We can perform the same setup but this time not using greedy but the sampling version</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/create_sbm.html">create_sbm</a></span>(edges, nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/collapse_groups.html">collapse_groups</a></span>(<span class="dt">greedy =</span> <span class="ot">FALSE</span>, <span class="dt">num_group_proposals =</span> <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw">results_to_df</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw">plot_merge_results</span>()</a></code></pre></div>
<p><img src="agglomerative_merging_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div id="controlling-number-of-merge-checks-per-node" class="section level2">
<h2 class="hasAnchor">
<a href="#controlling-number-of-merge-checks-per-node" class="anchor"></a>Controlling number of merge checks per node</h2>
<p>We can try scanning over different number of checks per group to see how it changes results</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">merges_over_changes &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">5</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="op">~</span>{</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    run_time &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>({</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">      merge_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_sbm.html">create_sbm</a></span>(edges, nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">        </span><span class="kw"><a href="../reference/collapse_groups.html">collapse_groups</a></span>(<span class="dt">num_group_proposals =</span> .x) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">        </span><span class="kw">results_to_df</span>()</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    })</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    merge_results <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">checks =</span> .x, <span class="dt">run_time =</span> run_time[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  })</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="kw">plot_merge_results</span>(merges_over_changes) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>checks) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Tuning number of merge checks per node"</span>)</a></code></pre></div>
<p><img src="agglomerative_merging_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">greedy_run_time &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>({</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="kw"><a href="../reference/create_sbm.html">create_sbm</a></span>(edges, nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="../reference/collapse_groups.html">collapse_groups</a></span>(<span class="dt">greedy =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">    </span><span class="kw">results_to_df</span>()</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">}) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pluck</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">merges_over_changes <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(checks) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">run_time =</span> <span class="kw">first</span>(run_time)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> checks, <span class="dt">y =</span> run_time)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> greedy_run_time, <span class="dt">color =</span> <span class="st">'orangered'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Run time by number of merges checked per group"</span>,</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">       <span class="dt">subtitle =</span> <span class="st">"Horizontal line is runtime of greedy merging"</span>)</a></code></pre></div>
<p><img src="agglomerative_merging_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="controlling-number-of-mcmc-sweeps-between-merge-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#controlling-number-of-mcmc-sweeps-between-merge-steps" class="anchor"></a>Controlling number of MCMC sweeps between merge steps</h2>
<p>Another tuning parameter that will effect results is how many mcmc sweeps are performed between each merge step. When we let the model perform more MCMC sweeps in theory it will equilibriate to the best partition with the current number of groups, meaning we would get a better picture of the best entropy for a given number of clusters.</p>
<p>Here we scan over different numbers of MCMC sweeps and if we use greedy or not for our merging (in theory greedy should not be particularly helpful here.)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">merges_over_sweeps_and_greedy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">mcmc_sweeps =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1</span>, <span class="dv">101</span>, <span class="dt">by =</span> <span class="dv">25</span>),</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">greedy =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span>{</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">map2_dfr</a></span>(</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">      .<span class="op">$</span>mcmc_sweeps,</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">      .<span class="op">$</span>greedy,</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">      <span class="op">~</span>{</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">        <span class="kw"><a href="../reference/create_sbm.html">create_sbm</a></span>(edges, nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">          </span><span class="kw"><a href="../reference/collapse_groups.html">collapse_groups</a></span>(<span class="dt">greedy =</span> .y, <span class="dt">num_mcmc_sweeps =</span> .x) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="st">          </span><span class="kw">results_to_df</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">mcmc_sweeps =</span> .x, <span class="dt">greedy =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"greedy = "</span>, .y))</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">      }</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">    )</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb11-17" data-line-number="17"></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="kw">plot_merge_results</span>(merges_over_sweeps_and_greedy) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="st">  </span><span class="kw">facet_grid</span>(mcmc_sweeps<span class="op">~</span>greedy) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Tuning and greedy status and number of mcmc sweeps per stage"</span>)</a></code></pre></div>
<p><img src="agglomerative_merging_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="controlling-collapsing-rate-sigma" class="section level2">
<h2 class="hasAnchor">
<a href="#controlling-collapsing-rate-sigma" class="anchor"></a>Controlling collapsing rate (sigma)</h2>
<p>Another important parameter to tune is <code>SIGMA</code>. This controls the rate that the network collapses. For each merge step the model will remove <code>B_curr/SIGMA</code> groups. This means a value of <code>SIGMA = 2</code> will cut the group size in half each step. If we were to set <code>SIGMA</code> below <code>1</code>, this would force the model to remove a single group at a time (if no MCMC sweeps are happening) because <code>B_curr/{x&lt;1} &gt; B_curr</code> so the smallest possible merge of a single group is taken.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from =</span> <span class="fl">0.9</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="op">~</span>{</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="kw"><a href="../reference/create_sbm.html">create_sbm</a></span>(edges, nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">      </span><span class="kw"><a href="../reference/collapse_groups.html">collapse_groups</a></span>(<span class="dt">exhaustive =</span> <span class="ot">FALSE</span>, <span class="dt">sigma =</span> .x, <span class="dt">num_mcmc_sweeps =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">      </span><span class="kw">results_to_df</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">sigma =</span> .x)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  }) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">  </span><span class="kw">plot_merge_results</span>(<span class="dt">trim_axes =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sigma) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Tuning sigma value for merging"</span>)</a></code></pre></div>
<p><img src="agglomerative_merging_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#basic-merging">Basic merging</a></li>
      <li><a href="#non-greedy-merge-proposals">Non-Greedy merge proposals</a></li>
      <li><a href="#controlling-number-of-merge-checks-per-node">Controlling number of merge checks per node</a></li>
      <li><a href="#controlling-number-of-mcmc-sweeps-between-merge-steps">Controlling number of MCMC sweeps between merge steps</a></li>
      <li><a href="#controlling-collapsing-rate-sigma">Controlling collapsing rate (sigma)</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nick Strayer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
